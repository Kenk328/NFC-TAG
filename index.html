<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>HOMEO Proto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; }
        button { font-size: 1.5em; padding: 20px; margin: 10px; width: 80%; }
    </style>
</head>
<body>
    <h1 id="location-display">...</h1>
    <button onclick="reportAction('発見')">問題を発見</button>
    <button onclick="reportAction('完了')">作業を完了</button>
    <p id="status-message"></p>

    <script>
        // STEP 2で取得した、あなたのGoogle Apps ScriptのウェブアプリURLをここに貼り付ける
        const API_URL = "https://script.google.com/macros/s/AKfycbzTgYgUoWJWpbGGIQc8ajoLhEA3WICuJyUORnyRYxTqdEH9OMXfaaH7XoQOJ7V-fNIo/exec";

        // ページが読み込まれた時に実行
        window.onload = function() {
            // 1. URLから場所IDを取得して表示
            const urlParams = new URLSearchParams(window.location.search);
            const locationId = urlParams.get('location');
            document.getElementById('location-display').textContent = `場所: ${locationId || '不明'}`;
        };
        
        // 2. ボタンが押された時に実行される関数
        async function reportAction(actionType) {
            const urlParams = new URLSearchParams(window.location.search);
            const locationId = urlParams.get('location');
            
            // ここでは仮のユーザーEmailを入れています（Glideを使わない場合の簡易的な方法）
            const userEmail = "test-user@community.jp"; 
            
            document.getElementById('status-message').textContent = '送信中...';

            // 3. Google Apps Scriptに送信するデータを作成
            const dataToSend = {
                email: userEmail,
                location: locationId,
                action: actionType
            };

            // 4. APIにデータをPOSTメソッドで送信
            try {
                // fetch APIを使ってGASにリクエストを送信
                // mode: 'no-cors'はクロスオリジン通信のおまじない
                await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSend),
                    redirect: 'follow'
                });
                document.getElementById('status-message').textContent = `「${actionType}」を記録しました！`;
            } catch (error) {
                document.getElementById('status-message').textContent = `エラーが発生しました: ${error}`;
            }
        }
    </script>
</body>

</html>
